Восстановление работоспособности веб-сервера

Введение
В ходе проекта была проведена диагностика и устранение проблем, связанных с неработоспособностью веб-сервера на Amazon Linux (http://3.77.35.146). Основной целью было восстановление веб-приложения (сайт “MediaWiki”), запущенного на сервере, и анализ причин, приведших к инциденту.

Причины инцидента
При первой попытке запроса на сервер с помощью команды ping, ответа не последовало. Сервер не запускался, сайт не отвечал.

Анализ файловой системы и диагностика сервера показали, что причиной отказа веб-приложения стали следующие факторы:
Процесс `httpd` был неактивен и сервер прекратил свою работу.
На сервере закончилось свободное место на диске (100% занято).
Лог-файл `/var/log/httpd/access_log` занимал 10ГБ, что привело к исчерпанию дискового пространства и безостановочно увеличивался при каждом входе на сервер.
Файл конфигурации `LocalSettings.php` отсутствовал в каталоге `/var/www/html/mediawiki/`.
В конфигурационном файле `LocalSettings.php` был указан некорректный адрес сервера.

Шаги по восстановлению работоспособности
Проверка и запуск веб-сервера
Командой `sudo service httpd status` выявлено, что сервис Apache был неактивен.
Запущен сервис: `sudo service httpd start`.
Подтверждена его работа (`sudo service httpd status`).

Восстановление конфигурационного файла
Исходный файл `LocalSettings (5).php` скопирован в нужный каталог:
     ```bash
     cp /home/ec2-user/LocalSettings\ \(5\).php /var/www/html/mediawiki/LocalSettings.php
     ```
В файле исправлен параметр `$wgServer` на актуальный IP-адрес сервера.

Освобождение дискового пространства
Анализ использования диска командой `df -h` подтвердил его заполненность.
Поиск крупных файлов через `find / -type f -size +100M -exec du -h {} +` выявил огромный лог-файл `/var/log/httpd/access_log`.
Файл был очищен (`echo "" > /var/log/httpd/access_log`), что освободило место.

Настройка автоматической очистки логов
Написан скрипт `/home/ec2-user/backup_logs.sh`, который ежедневно архивирует и очищает лог-файл:
     
     #!/bin/bash
     LOG_DIR="/var/log/httpd"
     LOG_FILE="access_log"
     BACKUP_DIR="/var/log/httpd/backups"
     DATE=$(date +%Y%m%d)
     ARCHIVE="$BACKUP_DIR/$LOG_FILE-$DATE.tar.gz"
     tar -czf "$ARCHIVE" "$LOG_DIR/$LOG_FILE"
     echo "" > "$LOG_DIR/$LOG_FILE"

chmod +x /backup_logs.sh

   Добавлена задача в crontab (`crontab -e`):

     35 11 * * * /home/ec2-user/backup_logs.sh

Результаты
Веб-сервер был успешно запущен и сайт начал работать.
Освобождено дисковое пространство.
Файл конфигурации восстановлен, исправлены ошибки.
Настроена автоматическая очистка логов для предотвращения повторных проблем.

Рекомендации по предотвращению инцидентов в будущем
Мониторинг дискового пространства
   Настроить автоматические уведомления при заполнении диска (`df -h` и `du -sh`).
Ограничение размера логов
   Настроить `logrotate` для автоматического управления лог-файлами.

Резервное копирование конфигурационных файлов
   Хранить копии важных конфигураций (`LocalSettings.php`) в надёжном месте.

 Мониторинг состояния сервисов
   Использовать `systemctl` и `cron` для автоматического перезапуска Apache при сбоях.
Мониторинг загрузки сервера и состояния служб
Рекомендуется добавить мониторинг процессов на сервере и проверку состояния служб:
top
systemctl status apache2
ps aux | grep httpd
Эти команды помогут убедиться, что не только веб-сервер работает, но и другие важные процессы активны.
Вывод
Проект позволил отработать диагностику серверных проблем, восстановление веб-приложения и настройку автоматического управления логами. Выполненные шаги помогут предотвратить подобные инциденты в будущем и обеспечат стабильную работу сервиса.
